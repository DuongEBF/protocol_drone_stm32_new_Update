/*
 * uart_irq.c
 *
 *  Created on: Aug 13, 2025
 *      Author: duong
 */
#include "uart_irq.h"
#include "ring_buff.h"
extern UART_HandleTypeDef huart3;
extern UART_HandleTypeDef huart2;
#define RING_UART_LEN_TOBUFI 512
#define RING_UART_LEN_FC 512
Ring_buff_t ring_tobufi;
Ring_buff_t ring_fc;
uint8_t data_rx_fc;
uint8_t data_rx_tobufi;
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
	if(huart->Instance == USART3)
	{
		receive_rx_fc(data_rx_fc);
		HAL_UART_Receive_IT(huart, &data_rx_fc, 1);
	}
	if(huart->Instance == USART2)
	{
		receive_rx_tobufi(data_rx_tobufi);
		HAL_UART_Receive_IT(huart, &data_rx_tobufi, 1);
	}
}
void receive_rx_fc(uint8_t data_rx)
{
	ring_buffer_push(&ring_fc, data_rx);
}
void receive_rx_tobufi(uint8_t data_rx)
{
	ring_buffer_push(&ring_tobufi, data_rx);
}


uint16_t uart_available_fc(void)
{
	return ring_buffer_available(&ring_fc);
}
uint16_t uart_available_tobufi(void)
{
	return ring_buffer_available(&ring_tobufi);
}


uint8_t uart_read_fc(void)
{
	uint8_t data_pop;
	ring_buffer_pop(&ring_fc, &data_pop);
	return data_pop;
}
uint8_t uart_read_tobufi(void)
{
	uint8_t data_pop;
	ring_buffer_pop(&ring_tobufi, &data_pop);
	return data_pop;
}


void uart_init_fc(void)
{
	HAL_UART_Receive_IT(&huart3, &data_rx_fc, 1);
	ring_buffer_init(&ring_fc, &data_rx_fc, RING_UART_LEN_FC);
}
void uart_init_tobufi(void)
{
	HAL_UART_Receive_IT(&huart2, &data_rx_tobufi, 1);
	ring_buffer_init(&ring_tobufi, &data_rx_tobufi, RING_UART_LEN_TOBUFI);
}

